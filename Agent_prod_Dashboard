SELECT 
    CONVERT(Date, CALLDATETIME) AS [Date],
	LOGIN AS [Login ID],
	AGENTNAME AS [Agent_Name],
    COUNT(SOURCEID) AS [Accounts Worked],
    SUM(CASE 
        WHEN CONVERT(Int, QCODE) IN (0, 1, 2, 4, 5, 6, 10, 20, 80, 81, 82, 83, 84, 85, 95, 97, 92, 131) THEN 0
        WHEN CONVERT(Int, QCODE) IN (9, 70, 71, 90, 91, 93, 94, 96, 98, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 
		116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 127, 128, 129, 130, 132, 133) THEN 1
        ELSE NULL 
    END) AS [Contact Indicator],


	SUM(CASE 
        WHEN Convert(Int,QCODE) IN (1, 2, 4, 5, 6, 10, 20, 70, 80, 81, 82, 83, 84, 85, 92, 93, 95, 96, 97, 131) THEN 0
		WHEN Convert(Int,QCODE) IN (71, 90, 91, 94, 98, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123,
		124, 125, 127, 128, 129, 130, 132, 133) THEN 1
		ELSE NULL
		END) AS [RPC Indicator],

CASE     WHEN COUNT(SOURCEID) > 0 THEN CAST(SUM(CASE 
         WHEN CONVERT(Int, QCODE) IN (9, 70, 71, 90, 91, 93, 94, 96, 98, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 
	     116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 127, 128, 129, 130, 132, 133) THEN 1
            ELSE NULL 
        END) AS FLOAT) / COUNT(SOURCEID)
        ELSE 0
    END AS [Contact Rate],

CASE
        WHEN COUNT(SOURCEID) > 0 THEN CAST(SUM(CASE 
            WHEN CONVERT(Int, QCODE) IN (71, 90, 91, 94, 98, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123,
		124, 125, 127, 128, 129, 130, 132, 133) THEN 1
            ELSE NULL 
        END) AS FLOAT) / COUNT(SOURCEID)
        ELSE 0
    END AS [RPC Rate],


    SUM(CASE 
        WHEN CONVERT(Int, QCODE) IN (0, 1, 2, 4, 5, 6, 10, 20, 80, 81, 82, 83, 84, 85, 95, 97, 92, 131, 9, 70, 71, 90, 91, 93, 94, 96, 98, 100, 101, 102, 103, 104, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 
		116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 127, 128, 129) THEN 0
		WHEN CONVERT(Int, QCODE) IN (105, 130, 132, 133) THEN 1
        ELSE NULL
    END) AS [Sales Dipositioned],

    CASE
        WHEN COUNT(SOURCEID) > 0 THEN CAST(SUM(CASE 
            WHEN CONVERT(Int, QCODE) IN (105, 130, 132, 133) THEN 1
            ELSE NULL 
        END) AS FLOAT) / COUNT(SOURCEID)
        ELSE 0
    END AS [Conversion Rate]


FROM OutboundLog_Detail

WHERE SERVICEID in (1200) AND CALLDATETIME >= '2024-09-03 00:00:00'

GROUP BY CONVERT(Date, CALLDATETIME), AGENTNAME, LOGIN
ORDER BY AGENTNAME DESC, Date DESC
